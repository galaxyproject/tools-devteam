<?xml version="1.0"?>
<tool id="bcftools_view" name="BCFTools" version="0.2.0">
    <description>Convert, filter, subset VCF/BCF files</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <command>
<![CDATA[
        @INPUT_FORMAT@
        bcftools view "$input" $dropgenotypes $headers --compression-level $compression --output-file "$output"
            --output-type $output_format $novelsites $knownsites $excludephased $selectphased
        #if $varExists('$region.regioninput')
            --regions-file $region.regioninput
        #end if
        #if $varExists('$target.targetinput')
            --target-file $target.targetinput
        #end if
]]>
    </command>
    <inputs>
        <expand macro="vcf_input" />
        <param name="headers" type="select" label="header handling" help="--header-only/--no-header">
            <option value="" selected="true">Headers in Output</option>
            <option value="--no-header">No Headers in Output</option>
            <option value="--header-only">Only Headers in Output</option>
        </param>
        <expand macro="output_format_selector" />
        <param name="compression"  type="integer" value="-1" min="-1" max="9" help="--compressionLevel" label="Compression Level (0: no compression, 1: best speed, 9: best compression"/>
        <param name="dropgenotypes" type="boolean" truevalue="--drop-genotypes" falsevalue="" checked="false" label="drop individual genotype information (after subsetting if -s is put)" help="--drop-genotypes"/>

        <conditional name="region">
            <param name="regionfile" type="select" label="restrict to regions in file with index-jumps">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="yes">
                <param format="bed" name="regioninput" type="data" label="BED file"/>
            </when>
        </conditional>
        <conditional name="target">
            <param name="targetfile" type="select" label="restrict to regions in file with streams">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="yes">
                <param format="bed" name="targetinput" type="data" label="BED file"/>
            </when>
        </conditional>

        <param name="trimalleles" type="boolean" truevalue="--trim-alt-alleles" falsevalue="" checked="false" label="Trim Alternate Alleles not Seen in the Subset" help="--trim-alt-alleles"/>
        <param name="noupdate" type="boolean" truevalue="--no-update" falsevalue="" checked="false" label="Do not (Re)Calculate INFO Fields for the Subset" help="--no-updates"/>

        <param name="knownsites" type="boolean" truevalue="--known" falsevalue="" checked="false" label="Known Sites only" help="--known"/>
        <param name="novelsites" type="boolean" truevalue="--novel" falsevalue="" checked="false" label="Novel Sites only" help="--novel"/>
        <param name="selectphased" type="boolean" truevalue="--phased" falsevalue="" checked="false" label="Select Sites where all Samples are Phased" help="--phased"/>
        <param name="excludephased" type="boolean" truevalue="--exclude-phased" falsevalue="" checked="false" label="Exclude Sites where all Samples are Phased" help="--exclude-phased"/>
        <param name="selectuncalled" type="boolean" truevalue="--uncalled" falsevalue="" checked="false" label="Select Sites without a called Genotype" help="--uncalled"/>
        <param name="excludeuncalled" type="boolean" truevalue="--exclude-uncalled" falsevalue="" checked="false" label="Exclude Sites without a called Genotype" help="--exclude-uncalled"/>
        <param name="selectprivate" type="boolean" truevalue="--private" falsevalue="" checked="false" label="Select Sites where the non-reference Alleles are exclusive (private) to the Subset Samples" help="--private"/>
        <param name="excludeprivate" type="boolean" truevalue="--exclude-private" falsevalue="" checked="false" label="Exclude Sites where the non-reference Alleles are exclusive (private) to the Subset Samples" help="--private"/>

    </inputs>
    <outputs>
        <expand macro="output_dataset" />
    </outputs>
    <tests>
        <test>
            <param ftype="vcf_bgzip" name="input" value="bcftools_view_in1.vcf.gz" />
            <param name="output_format" value="v" />
            <output file="bcftools_view_out1.vcf" ftype="vcf" lines_diff="2" name="output" />
        </test>
        <test>
            <param ftype="bcf" name="input" value="bcftools_view_in1.bcf" />
            <param name="output_format" value="v" />
            <output file="bcftools_view_out1.vcf" ftype="vcf" lines_diff="2" name="output" />
        </test>
        <test>
            <param ftype="vcf" name="input" value="bcftools_view_in1.vcf" />
            <param name="output_format" value="v" />
            <output file="bcftools_view_out1.vcf" ftype="vcf" lines_diff="2" name="output" />
        </test>
    </tests>
    <help>
<![CDATA[
**BCFTools View**

VCF/BCF conversion, view, subset and filter VCF/BCF files.

-----

**Input format**

compressed or uncompressed VCF or BCF files

------

**Outputs**

compressed or uncompressed VCF or BCF files

]]>
    </help>
    <expand macro="citations" />
</tool>
